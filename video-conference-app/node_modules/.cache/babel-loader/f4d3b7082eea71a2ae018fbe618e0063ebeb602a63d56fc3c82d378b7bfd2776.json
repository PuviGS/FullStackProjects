{"ast":null,"code":"var _jsxFileName = \"/home/puvi/Desktop/video-conference-app/client/src/components/VideoRoom.js\",\n  _s = $RefreshSig$();\nimport { useEffect, useRef } from 'react';\nimport io from 'socket.io-client';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst socket = io('http://localhost:5000');\nfunction VideoRoom({\n  roomId\n}) {\n  _s();\n  const videoRef = useRef();\n  const peerConnections = useRef({});\n  const remoteVideos = useRef({});\n  useEffect(() => {\n    const userId = Math.random().toString(36).substring(2);\n    socket.emit('join-room', roomId, userId);\n    navigator.mediaDevices.getUserMedia({\n      video: true,\n      audio: true\n    }).then(stream => {\n      videoRef.current.srcObject = stream;\n      socket.on('user-connected', newUserId => {\n        const peerConnection = new RTCPeerConnection();\n        peerConnections.current[newUserId] = peerConnection;\n        stream.getTracks().forEach(track => peerConnection.addTrack(track, stream));\n        peerConnection.onicecandidate = event => {\n          if (event.candidate) {\n            socket.emit('ice-candidate', newUserId, event.candidate);\n          }\n        };\n        peerConnection.ontrack = event => {\n          if (!remoteVideos.current[newUserId]) {\n            const remoteVideo = document.createElement('video');\n            remoteVideo.autoplay = true;\n            remoteVideo.playsInline = true;\n            remoteVideo.srcObject = event.streams[0];\n            remoteVideos.current[newUserId] = remoteVideo;\n            document.body.append(remoteVideo);\n          }\n        };\n        peerConnection.createOffer().then(offer => peerConnection.setLocalDescription(offer)).then(() => {\n          socket.emit('offer', newUserId, peerConnection.localDescription);\n        });\n      });\n      socket.on('offer', async (fromUserId, description) => {\n        const peerConnection = new RTCPeerConnection();\n        peerConnections.current[fromUserId] = peerConnection;\n        stream.getTracks().forEach(track => peerConnection.addTrack(track, stream));\n        peerConnection.ontrack = event => {\n          if (!remoteVideos.current[fromUserId]) {\n            const remoteVideo = document.createElement('video');\n            remoteVideo.autoplay = true;\n            remoteVideo.playsInline = true;\n            remoteVideo.srcObject = event.streams[0];\n            remoteVideos.current[fromUserId] = remoteVideo;\n            document.body.append(remoteVideo);\n          }\n        };\n        peerConnection.onicecandidate = event => {\n          if (event.candidate) {\n            socket.emit('ice-candidate', fromUserId, event.candidate);\n          }\n        };\n        await peerConnection.setRemoteDescription(description);\n        const answer = await peerConnection.createAnswer();\n        await peerConnection.setLocalDescription(answer);\n        socket.emit('answer', fromUserId, peerConnection.localDescription);\n      });\n      socket.on('answer', (toUserId, description) => {\n        peerConnections.current[toUserId].setRemoteDescription(description);\n      });\n      socket.on('ice-candidate', (userId, candidate) => {\n        peerConnections.current[userId].addIceCandidate(new RTCIceCandidate(candidate));\n      });\n      socket.on('user-disconnected', userId => {\n        if (peerConnections.current[userId]) {\n          peerConnections.current[userId].close();\n          delete peerConnections.current[userId];\n        }\n        if (remoteVideos.current[userId]) {\n          remoteVideos.current[userId].remove();\n          delete remoteVideos.current[userId];\n        }\n      });\n    });\n    return () => {\n      socket.off();\n    };\n  }, [roomId]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"video-room\",\n    children: /*#__PURE__*/_jsxDEV(\"video\", {\n      ref: videoRef,\n      autoPlay: true,\n      playsInline: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 104,\n    columnNumber: 5\n  }, this);\n}\n_s(VideoRoom, \"ELzfITVoGUKVR2s8ALdl8DdRqek=\");\n_c = VideoRoom;\nexport default VideoRoom;\nvar _c;\n$RefreshReg$(_c, \"VideoRoom\");","map":{"version":3,"names":["useEffect","useRef","io","jsxDEV","_jsxDEV","socket","VideoRoom","roomId","_s","videoRef","peerConnections","remoteVideos","userId","Math","random","toString","substring","emit","navigator","mediaDevices","getUserMedia","video","audio","then","stream","current","srcObject","on","newUserId","peerConnection","RTCPeerConnection","getTracks","forEach","track","addTrack","onicecandidate","event","candidate","ontrack","remoteVideo","document","createElement","autoplay","playsInline","streams","body","append","createOffer","offer","setLocalDescription","localDescription","fromUserId","description","setRemoteDescription","answer","createAnswer","toUserId","addIceCandidate","RTCIceCandidate","close","remove","off","className","children","ref","autoPlay","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["/home/puvi/Desktop/video-conference-app/client/src/components/VideoRoom.js"],"sourcesContent":["import { useEffect, useRef } from 'react';\nimport io from 'socket.io-client';\n\nconst socket = io('http://localhost:5000');\n\nfunction VideoRoom({ roomId }) {\n  const videoRef = useRef();\n  const peerConnections = useRef({});\n  const remoteVideos = useRef({});\n\n  useEffect(() => {\n    const userId = Math.random().toString(36).substring(2);\n    socket.emit('join-room', roomId, userId);\n\n    navigator.mediaDevices.getUserMedia({ video: true, audio: true })\n      .then((stream) => {\n        videoRef.current.srcObject = stream;\n\n        socket.on('user-connected', (newUserId) => {\n          const peerConnection = new RTCPeerConnection();\n          peerConnections.current[newUserId] = peerConnection;\n\n          stream.getTracks().forEach((track) => peerConnection.addTrack(track, stream));\n\n          peerConnection.onicecandidate = (event) => {\n            if (event.candidate) {\n              socket.emit('ice-candidate', newUserId, event.candidate);\n            }\n          };\n\n          peerConnection.ontrack = (event) => {\n            if (!remoteVideos.current[newUserId]) {\n              const remoteVideo = document.createElement('video');\n              remoteVideo.autoplay = true;\n              remoteVideo.playsInline = true;\n              remoteVideo.srcObject = event.streams[0];\n              remoteVideos.current[newUserId] = remoteVideo;\n              document.body.append(remoteVideo);\n            }\n          };\n\n          peerConnection.createOffer()\n            .then((offer) => peerConnection.setLocalDescription(offer))\n            .then(() => {\n              socket.emit('offer', newUserId, peerConnection.localDescription);\n            });\n        });\n\n        socket.on('offer', async (fromUserId, description) => {\n          const peerConnection = new RTCPeerConnection();\n          peerConnections.current[fromUserId] = peerConnection;\n\n          stream.getTracks().forEach((track) => peerConnection.addTrack(track, stream));\n\n          peerConnection.ontrack = (event) => {\n            if (!remoteVideos.current[fromUserId]) {\n              const remoteVideo = document.createElement('video');\n              remoteVideo.autoplay = true;\n              remoteVideo.playsInline = true;\n              remoteVideo.srcObject = event.streams[0];\n              remoteVideos.current[fromUserId] = remoteVideo;\n              document.body.append(remoteVideo);\n            }\n          };\n\n          peerConnection.onicecandidate = (event) => {\n            if (event.candidate) {\n              socket.emit('ice-candidate', fromUserId, event.candidate);\n            }\n          };\n\n          await peerConnection.setRemoteDescription(description);\n          const answer = await peerConnection.createAnswer();\n          await peerConnection.setLocalDescription(answer);\n          socket.emit('answer', fromUserId, peerConnection.localDescription);\n        });\n\n        socket.on('answer', (toUserId, description) => {\n          peerConnections.current[toUserId].setRemoteDescription(description);\n        });\n\n        socket.on('ice-candidate', (userId, candidate) => {\n          peerConnections.current[userId].addIceCandidate(new RTCIceCandidate(candidate));\n        });\n\n        socket.on('user-disconnected', (userId) => {\n          if (peerConnections.current[userId]) {\n            peerConnections.current[userId].close();\n            delete peerConnections.current[userId];\n          }\n          if (remoteVideos.current[userId]) {\n            remoteVideos.current[userId].remove();\n            delete remoteVideos.current[userId];\n          }\n        });\n      });\n\n    return () => {\n      socket.off();\n    };\n  }, [roomId]);\n\n  return (\n    <div className=\"video-room\">\n      <video ref={videoRef} autoPlay playsInline></video>\n    </div>\n  );\n}\n\nexport default VideoRoom;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}